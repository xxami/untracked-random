
#region Description
/**
 * Title: Texploit
 * Description: Entry for the Moosader Gamedev Compo #7: "Text-based game"
 */
#endregion

using System;
using System.IO;
using System.Reflection;

namespace Texploit
{
    public class RemoteData
    {
        private static TexploitGameInterface game_iface = null;

        public RemoteData(TexploitGameInterface igame)
        {
            game_iface = igame;
        }

        public static TexploitGameInterface GetIFace()
        {
            return game_iface;
        }
    }

    public class AppRuntime : MarshalByRefObject
    {
        public void InitRemoteData(TexploitGameInterface igame)
        {
            new RemoteData(igame);
        }

        public bool ExecuteDll(string dll_path, string dll_name, string[] fparams)
        {
            Assembly asm = AppDomain.CurrentDomain.Load(File.ReadAllBytes(dll_path + "\\" + dll_name));
            MethodInfo main = null;
            foreach (Type t in asm.GetTypes())
            {
                MethodInfo method = t.GetMethod("Main", BindingFlags.Static | BindingFlags.Public);
                if (method != null)
                {
                    main = method;
                }
            }
            if (main != null)
            {
                main.Invoke(null, new object[] { fparams });
                return true;
            }

            return false;
        }
    }
}